<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Admin Panel | UltraWebs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase SDK -->
  <script type="module" src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js"></script>

  <!-- Google Fonts & Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <style>
    :root {
      --primary: #00e5ff;
      --accent-error: #ef5350;
      --text-light: #e0e0e0;
      --text-muted: #b0bec5;
      --radius: 16px;
      --transition: 0.3s;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Space Grotesk", sans-serif;
      background: url("https://wallpapercave.com/wp/wp15392660.jpg") no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: 0;
    }

    header {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: var(--primary);
      z-index: 1;
    }

    .container {
      width: 100%;
      max-width: 950px;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      z-index: 1;
    }

    .card {
      backdrop-filter: blur(15px);
      background-color: rgba(20, 20, 20, 0.5);
      border-radius: var(--radius);
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      transition: box-shadow var(--transition) ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      width: 100%;
    }

    .card:hover {
      box-shadow: 0 12px 40px rgba(0, 191, 165, 0.6);
    }

    h2 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 1rem;
    }

    label {
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
    }

    input[type="text"],
    select {
      padding: 12px 16px;
      font-size: 1rem;
      border-radius: var(--radius);
      border: 1px solid rgba(255, 255, 255, 0.2);
      background-color: rgba(0, 0, 0, 0.4);
      color: var(--text-light);
      outline: none;
      transition: 0.3s;
      backdrop-filter: blur(5px);
    }

    input[type="text"]::placeholder {
      color: #aaa;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: var(--primary);
      background-color: rgba(0, 0, 0, 0.6);
    }

    button {
      background-color: var(--primary);
      border: none;
      border-radius: var(--radius);
      padding: 14px 20px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      color: #121212;
      box-shadow: 0 4px 15px rgba(0, 191, 165, 0.5);
      transition: 0.3s;
      margin-top: 1rem;
    }

    button:hover {
      background-color: #26c6da;
      box-shadow: 0 6px 20px rgba(0, 191, 165, 0.7);
    }

    .preview {
      text-align: center;
      padding: 1rem;
      border-radius: var(--radius);
      border: 1px solid rgba(255, 255, 255, 0.3);
      background-color: rgba(0, 0, 0, 0.3);
      box-shadow: 0 4px 15px rgba(0, 191, 165, 0.3);
      backdrop-filter: blur(10px);
      margin-top: 1rem;
    }

    .preview img {
      max-width: 120px;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .timestamp {
      margin-top: 6px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .popup {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background-color: var(--primary);
      color: #121212;
      padding: 12px 20px;
      border-radius: var(--radius);
      box-shadow: 0 0 25px rgba(0, 191, 165, 0.7);
      font-weight: 700;
      display: none;
      z-index: 1000;
    }

    .popup.error {
      background-color: var(--accent-error);
      color: #fff;
      box-shadow: 0 0 25px rgba(255, 0, 0, 0.7);
    }

    /* New Saved Data Styles */
    .saved-channels {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .channel-card {
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 1rem;
      align-items: center;
      background-color: rgba(20, 20, 20, 0.6);
      padding: 1rem;
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(0, 191, 165, 0.3);
      transition: 0.3s;
      word-break: break-word;
    }

    .channel-card img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      border-radius: 8px;
    }

    .channel-card:hover {
      box-shadow: 0 6px 20px rgba(0, 191, 165, 0.5);
    }

    .channel-info h3 {
      margin-bottom: 0.5rem;
      color: var(--primary);
      font-size: 1.2rem;
    }

    .channel-info p {
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }

    .channel-info a {
      color: var(--primary);
      text-decoration: none;
      word-break: break-word;
    }

    .channel-info a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .channel-card {
        grid-template-columns: 80px 1fr;
      }

      .channel-card img {
        width: 80px;
        height: 80px;
      }
    }

    @media (max-width: 480px) {
      .channel-card {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
      }

      .channel-card img {
        width: 100%;
        height: auto;
        margin-bottom: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <header>UltraWebs Admin Panel</header>

  <main class="container">
    <div class="card">
      <h2>Update F1 Link</h2>

      <div class="form-group">
        <label for="title-prefix">Event Name</label>
        <input type="text" id="title-prefix" placeholder="Indian GP 2025 F1 Live" />
      </div>

      <div class="form-group">
        <label for="title-suffix">Session</label>
        <select id="title-suffix">
          <option value="Practice 1">Practice 1</option>
          <option value="Practice 2">Practice 2</option>
          <option value="Practice 3">Practice 3</option>
          <option value="Sprint Qualifying">Sprint Qualifying</option>
          <option value="Sprint">Sprint</option>
          <option value="Qualifying">Qualifying</option>
          <option value="Race">Race</option>
        </select>
      </div>

      <div class="form-group">
        <label for="logo">Logo URL</label>
        <input type="text" id="logo" placeholder="Enter logo URL" />
      </div>

      <div class="form-group">
        <label for="url">Stream URL (m3u8)</label>
        <input type="text" id="url" placeholder="Enter stream URL (m3u8)" />
      </div>

      <button id="saveBtn">Save Changes</button>

      <div class="preview">
        <img id="logo-preview" src="" alt="Logo Preview" />
        <p id="title-preview">Preview Title</p>
        <p class="timestamp" id="timestamp">Last Updated: --</p>
      </div>
    </div>

    <div class="card">
      <h2>Saved Database Preview</h2>
      <div class="saved-channels" id="saved-channels"></div>
    </div>
  </main>

  <div class="popup" id="popup-msg"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBMFvQQ-IRJ0-ihCsvF6gHhYakvm47H01A",
      authDomain: "f1linklive.firebaseapp.com",
      projectId: "f1linklive",
      storageBucket: "f1linklive.appspot.com",
      messagingSenderId: "1053156100165",
      appId: "1:1053156100165:web:fba7ff2a0e623cd8737b2c",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const prefixInput = document.getElementById("title-prefix");
    const suffixSelect = document.getElementById("title-suffix");
    const logoInput = document.getElementById("logo");
    const urlInput = document.getElementById("url");
    const saveBtn = document.getElementById("saveBtn");
    const logoPreview = document.getElementById("logo-preview");
    const titlePreview = document.getElementById("title-preview");
    const timestampEl = document.getElementById("timestamp");
    const popupMsg = document.getElementById("popup-msg");
    const savedChannels = document.getElementById("saved-channels");

    const channelDoc = doc(db, "channels", "f1");

    function formatDateTo12Hour(date) {
      const options = {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: true
      };
      return date.toLocaleString("en-US", options);
    }

    async function loadChannel() {
      const docSnap = await getDoc(channelDoc);
      savedChannels.innerHTML = "";
      if (docSnap.exists()) {
        const data = docSnap.data();
        const combinedTitle = data.title || "Untitled";
        const formattedDate = data.updatedAt || "--";

        // Preview
        titlePreview.textContent = combinedTitle;
        logoPreview.src = data.logo || "";
        timestampEl.textContent = `Last Updated: ${formattedDate}`;

        // Saved data card
        savedChannels.innerHTML = `
      <div class="channel-card">
        <img src="${data.logo}" alt="Logo" />
        <div class="channel-info">
          <h3>${combinedTitle}</h3>
          <p><strong>Stream URL:</strong> <a href="${data.url}" target="_blank">${data.url}</a></p>
          <p class="timestamp">Last Updated: ${formattedDate}</p>
        </div>
      </div>
    `;
      }
    }

    function updateTitlePreview() {
      const combined = prefixInput.value.trim() ? `${prefixInput.value.trim()} ${suffixSelect.value}` : suffixSelect.value;
      titlePreview.textContent = combined;
      return combined;
    }

    prefixInput.addEventListener("input", updateTitlePreview);
    suffixSelect.addEventListener("change", updateTitlePreview);
    logoInput.addEventListener("input", () => (logoPreview.src = logoInput.value || ""));

    function showPopup(msg, isError = false) {
      popupMsg.textContent = msg;
      popupMsg.classList.toggle("error", isError);
      popupMsg.style.display = "block";
      setTimeout(() => (popupMsg.style.display = "none"), 3000);
    }

    saveBtn.addEventListener("click", async () => {
      if (!prefixInput.value.trim() || !logoInput.value.trim() || !urlInput.value.trim()) {
        showPopup("Please fill all fields!", true);
        return;
      }
      try {
        const title = updateTitlePreview();
        const updatedAt = formatDateTo12Hour(new Date());
        await setDoc(channelDoc, {
          title,
          logo: logoInput.value.trim(),
          url: urlInput.value.trim(),
          updatedAt
        });

        showPopup("Channel updated successfully!");

        // Clear inputs
        prefixInput.value = "";
        suffixSelect.value = "Practice 1";
        logoInput.value = "";
        urlInput.value = "";
        logoPreview.src = "";
        titlePreview.textContent = "Preview Title";

        await loadChannel();
      } catch (err) {
        console.error(err);
        showPopup("Failed to update channel!", true);
      }
    });

    loadChannel();
  </script>
</body>

</html>
